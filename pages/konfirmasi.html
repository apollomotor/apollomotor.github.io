<span id="debug">

</span>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";
    const firebaseConfig = {
      apiKey: "AIzaSyBlmAsV6cYutrA7dRyhAiHm2xDrfOJnxA8",
      authDomain: "apolo-bengkel.firebaseapp.com",
      projectId: "apolo-bengkel",
      storageBucket: "apolo-bengkel.appspot.com",
      messagingSenderId: "538658758544",
      appId: "1:538658758544:web:1b311d0be1076c6d745d15",
      measurementId: "G-ZJ1VWM5ZTC"
    };
  
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    import {
        getFirestore, doc, getDoc, getDocs, setDoc, collection, addDoc, updateDoc, deleteDoc, deleteField
    }
    from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const db = getFirestore();

    import { getStorage, ref as RefSto, deleteObject } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";

    const storage = getStorage();

    function $_GET(param) {
        var vars = {};
        window.location.href.replace( location.hash, '' ).replace( 
            /[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
            function( m, key, value ) { // callback
                vars[key] = value !== undefined ? value : '';
            }
        );

        if ( param ) {
            return vars[param] ? vars[param] : null;	
        }
        return vars;
    }
    var id = $_GET('id');
    var act = $_GET('act');

    debug.textContent = "UPDATING " + id + " . . . ";
    
    var ref_ch = doc(db, "checkoutHistories", id);
    const docSnap_ch = await getDoc(ref_ch);
    var docref;
    switch(act){
        case 'Dikirim':
            docref = await updateDoc(
                ref_ch, {
                    status: "Dikirim"
                }
            )
            break;
        case 'Sampai':
            docref = await updateDoc(
                ref_ch, {
                    status: "Sampai"
                }
            )
            break;
        case 'Dibatalkan':
            docref = await updateDoc(
                ref_ch, {
                    status: "Dibatalkan"
                }
            )
            break;
        case 'Menunggu_Pembayaran':
            docref = await updateDoc(
                ref_ch, {
                    status: "Menunggu_Pembayaran"
                }
            )
            break;
        case 'Belum_Datang':
            docref = await updateDoc(
                ref_ch, {
                    status: "Belum_Datang"
                }
            )
            break;
        case 'Sudah_Datang':
            docref = await updateDoc(
                ref_ch, {
                    status: "Sudah_Datang"
                }
            )
            break;
        case 'Dikerjakan':
            docref = await updateDoc(
                ref_ch, {
                    status: "Dikerjakan"
                }
            )
            break;
        case 'Selesai':
            docref = await updateDoc(
                ref_ch, {
                    status: "Selesai"
                }
            )
            break;
    }
    await sleep(1000);
    location.href = "rekap.html";

    async function out(){
        debug.textContent = "Menghapus " + id + "....";
        await sleep(1000);
        debug.textContent = id + " Berhasil dihapus";
        await sleep(500);
        location.href = "tables.html"
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
</script>
<script src="login.js"></script>